<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gantt Builder — Firebase</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="topbar">
  <div class="brand">
    <div class="logo">G</div>
    <div class="title">
      <div class="h1">Gantt Builder</div>
      <div class="sub">בניית גאנטים דינאמית • שמירה לפרויקטים לפי משתמש • Firebase</div>
    </div>
  </div>

  <div class="top-actions">
    <button class="btn" id="btnOpenAuth">התחברות</button>
    <button class="btn" id="btnLogout" style="display:none">התנתקות</button>
  </div>
</header>

<main class="layout">
  <!-- Left / main gantt -->
  <section class="main">
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="btn" id="zoomOut">זום −</button>
        <button class="btn" id="zoomIn">זום +</button>
        <button class="btn" id="zoomReset">איפוס זום</button>
        <span class="muted" id="zoomInfo">יום: <span id="pxInfo">—</span>px</span>
      </div>

      <div class="toolbar-right">
        <button class="btn" id="btnNewProject" disabled>פרויקט חדש</button>
        <button class="btn" id="btnOpenProject" disabled>פתח פרויקט</button>
        <button class="btn" id="btnSaveProject" disabled>שמור</button>
        <span class="pill" id="projectPill" title="Project">אין פרויקט</span>
      </div>
    </div>

    <div class="controls">
      <strong>נושאים:</strong>
      <div id="topicsChips" class="chips"></div>
      <button class="btn" id="btnAll">בחר הכל</button>
      <button class="btn" id="btnClear">נקה הכל</button>
    </div>

    <div class="gantt" id="gantt">
      <svg class="link-layer" id="linkLayer"></svg>

      <div class="label-col" id="labelCol">
        <!-- dynamic -->
      </div>

      <div class="date-col" id="dateCol">
        <div class="timeline" id="timeline">
          <div class="scale-wrap">
            <div class="month-band" id="monthBand"></div>
            <div class="week-band" id="weekBand"></div>
            <div class="day-scale" id="dayScale">
              <div class="grid" id="grid"></div>
            </div>
          </div>
          <div class="today-line" id="todayLine" title="היום"></div>

          <div id="dateBlocks">
            <!-- dynamic -->
          </div>
        </div>
      </div>
    </div>

    <div class="below">
      <div class="card">
        <div class="card-h">
          <div>
            <div class="card-title">טבלת משימות</div>
            <div class="card-sub">עריכה, מחיקה, יצוא/יבוא CSV</div>
          </div>
          <div class="card-actions">
            <button class="btn" id="btnExportCSV" disabled>ייצוא CSV</button>
            <button class="btn" id="btnImportCSV" disabled>יבוא CSV</button>
            <input id="csvFile" type="file" accept=".csv,text/csv" style="display:none" />
          </div>
        </div>

        <div class="table-wrap">
          <table class="tbl" id="tasksTable">
            <thead>
              <tr>
                <th>נושא</th>
                <th>כותרת</th>
                <th>תאריך התחלה</th>
                <th>תאריך סיום</th>
                <th>משך (ימים)</th>
                <th>תיאור (לא מוצג בגאנט)</th>
                <th>פעולות</th>
              </tr>
            </thead>
            <tbody id="tasksTbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Right / panels -->
  <aside class="side">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">ניהול נושאים</div>
          <div class="card-sub">הוסף/ערוך/מחק • כולל צבע</div>
        </div>
      </div>

      <div class="form">
        <label>
          <span>שם נושא</span>
        <input id="topicName"
       type="text"
       name="topic_name"
       autocomplete="new-password"
       autocapitalize="off"
       autocorrect="off"
       spellcheck="false"
       placeholder='לדוגמה: "מסירות"' />
        </label>
        <label>
          <span>צבע</span>
          <input id="topicColor" type="color" value="#1f77b4" />
        </label>
        <div class="row">
          <button class="btn primary" id="btnAddTopic" disabled>הוסף נושא</button>
          <button class="btn" id="btnUpdateTopic" disabled>עדכן נושא</button>
        </div>
        <div class="row">
          <select id="topicSelect" disabled></select>
          <button class="btn danger" id="btnDeleteTopic" disabled>מחק נושא</button>
        </div>
        <div class="hint">מחיקת נושא תעדכן את המשימות ששויכו אליו (תעביר ל"לא משויך").</div>
      </div>
    </div>

    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">הוסף / ערוך משימה</div>
          <div class="card-sub">תאריך התחלה + תאריך סיום או משך</div>
        </div>
      </div>

      <div class="form">
        <label>
          <span>נושא</span>
          <select id="taskTopic" disabled></select>
        </label>
        <label>
          <span>כותרת (מוצג בגאנט)</span>
          <input id="taskTitle" type="text" placeholder="לדוגמה: בדיקות תקינות" disabled />
        </label>
        <label>
          <span>פירוט (לא מוצג בגאנט)</span>
          <textarea id="taskDesc" rows="3" placeholder="פרטים חופשיים…" disabled></textarea>
        </label>

        <div class="grid2">
          <label>
            <span>תאריך התחלה</span>
            <input id="taskStart" type="date" disabled />
          </label>
          <label>
            <span>תאריך סיום</span>
            <input id="taskEnd" type="date" disabled />
          </label>
        </div>

        <div class="grid2">
          <label>
            <span>או משך (ימים)</span>
            <input id="taskDuration" type="number" min="1" step="1" placeholder="לדוגמה: 5" disabled />
          </label>
          <div class="hint inline">
            אם תכניס משך + תאריך התחלה — תאריך הסיום יחושב אוטומטית.
          </div>
        </div>

        <div class="row">
          <button class="btn primary" id="btnAddTask" disabled>הוסף משימה</button>
          <button class="btn" id="btnUpdateTask" disabled>עדכן משימה</button>
          <button class="btn" id="btnClearTaskForm" disabled>נקה</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">הערות</div>
          <div class="card-sub">אבטחה + Firebase Rules</div>
        </div>
      </div>
      <div class="pad small">
        <ul class="bullets">
          <li>המידע נשמר תחת <span class="mono">users/{uid}/projects/{projectId}</span>.</li>
          <li>שיתוף בין משתמשים אפשרי בהמשך (roles/ACL).</li>
          <li>הדוגמה עובדת עם Firebase Auth (Email/Password).</li>
        </ul>
      </div>
    </div>
  </aside>
</main>

<!-- Project picker modal -->
<div class="modal" id="projectModal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-h">
      <div>
        <div class="modal-title" id="projectModalTitle">בחר פרויקט</div>
        <div class="modal-sub" id="projectModalSub">פרויקטים של המשתמש</div>
      </div>
      <button class="icon-btn" id="btnCloseProjectModal" aria-label="Close">✕</button>
    </div>

    <div class="modal-body">
      <div class="grid2">
        <label>
          <span>שם פרויקט חדש</span>
          <input id="newProjectName" type="text" placeholder="לדוגמה: תוכנית Q1" />
        </label>
        <button class="btn primary" id="btnCreateProject">צור</button>
      </div>

      <div class="hr"></div>

      <div class="list" id="projectsList"></div>
    </div>
  </div>
</div>

<!-- Auth modal -->
<div class="modal" id="authModal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-h">
      <div>
        <div class="modal-title">התחברות</div>
        <div class="modal-sub">Email/Password (למטרות דמו — אפשר להחליף ל-Google)</div>
      </div>
      <button class="icon-btn" id="btnCloseAuth" aria-label="Close">✕</button>
    </div>

    <div class="modal-body">
      <div class="grid2">
        <label>
          <span>Email</span>
          <input id="authEmail" type="email" placeholder="name@example.com" />
        </label>
        <label>
          <span>Password</span>
          <input id="authPass" type="password" placeholder="••••••••" />
        </label>
      </div>

      <div class="row">
        <button class="btn primary" id="btnLogin">התחבר</button>
        <button class="btn" id="btnRegister">הרשמה</button>
      </div>

      <div class="hint" id="authMsg"></div>
    </div>
  </div>
</div>

<script src="firebase-config.js"></script>
<script type="module" src="app.js"></script>
</body>
</html>
